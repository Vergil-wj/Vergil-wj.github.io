<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>使用CocoaPods构建自己的私有库</title>
  <meta name="description" content="使用 CocoaPods 建立一个私有库，将项目中的公共组件交由它管理，方便于其它项目的引用，也是组件化项目开发的第一步。">
  <meta name="author" content="leopardpan">

  <!-- <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="使用CocoaPods构建自己的私有库">
  <meta name="twitter:description" content="使用 CocoaPods 建立一个私有库，将项目中的公共组件交由它管理，方便于其它项目的引用，也是组件化项目开发的第一步。"> -->
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="使用CocoaPods构建自己的私有库">
  <meta property="og:description" content="使用 CocoaPods 建立一个私有库，将项目中的公共组件交由它管理，方便于其它项目的引用，也是组件化项目开发的第一步。">
  
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2019/04/04/%E4%BD%BF%E7%94%A8CocoaPods%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E7%A7%81%E6%9C%89%E5%BA%93.html">
  <link rel="alternate" type="application/rss+xml" title="Vergil" href="http://localhost:4000/feed.xml">
  
  <!-- <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" /> -->



</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      标签
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
        <div class="panel-main__content">
            <!-- 头像效果-start -->
            <div class="ih-item circle effect right_to_left">            
                <a href="/#blog" title="前往 Vergil 的主页" class="blog-button">
                    <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                    <div class="info">
                        <div class="info-back">
                            <h2> 
                                
                                Vergil
                                
                            </h2>
                            <p>
                             
                             iOS
                             
                         </p>
                     </div>
                 </div>
             </a>
         </div>
         <!-- 头像效果-end -->
         <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Vergil" class="blog-button">Vergil</a></h1>

         
         <span class="panel-cover__subtitle panel-subtitle">iOS 开发者</span>
         

         <hr class="panel-cover__divider" />
         <p class="panel-cover__description">我用双手成就你的梦想！</p>
         <hr class="panel-cover__divider panel-cover__divider--secondary" />

         


         <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                <li class="navigation__item"><a href="/tags" title="tags">标签</a></li>
                
            </ul>
        </nav>
    </div>          
</div>


</div>
</div>
</div>


<div class="panel-cover--overlay cover-clear"></div>

</div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title">使用CocoaPods构建自己的私有库</h1>
    <div class="post-meta"> 
      <time datetime="2019-04-04 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date">2019-04-04</time>  
    </div>
  </header>

  <section class="post">
    <p>使用 CocoaPods 建立一个私有库，将项目中的公共组件交由它管理，方便于其它项目的引用，也是组件化项目开发的第一步。</p>

<p>整体说明一下创建私有库的步骤：</p>

<ol>
  <li>创建并设置一个私有的 Spec Repo。</li>
  <li>创建Pod的所需要的项目工程文件，并且有可访问的项目版本控制地址。</li>
  <li>创建 Pod 所对应的 podspec 文件。</li>
  <li>上传项目到 GitHub,并打上 tag。</li>
  <li>本地测试配置好的 podspec文件是否可用。</li>
  <li>向私有的 Spec Repo 中提交 podspec。</li>
  <li>在个人项目中的 Podfile 中增加刚刚制作的好的 Pod 并使用。</li>
</ol>

<h2 id="创建私有的-spec-repo">创建私有的 Spec Repo</h2>

<p>什么是Spec Repo？</p>

<p>他是所有的 Pods 的一个索引，就是一个容器，所有公开的 Pods 都在这个里面，他实际是一个 Git 仓库 remote 端
在 GitHub 上，但是当你使用了 Cocoapods 后他会被 clone 到本地的 <code class="highlighter-rouge">~/.cocoapods/repos</code> 目录下，可以进入到这个目录看到 master 文件夹就是这个官方的 Spec Repo 了。这个 master 目录的结构是这个样子的：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── Specs
    └── [SPEC_NAME]
        └── [VERSION]
            └── [SPEC_NAME].podspec
</code></pre></div></div>

<p>因此我们需要创建一个类似于 master 的私有 Spec Repo，这里我们可以 fork  官方的 Repo，也可以自己创建，建议不 fork，因为你只是想添加自己的 Pods，没有必要把现有的公开 Pods 都 copy 一份，就如官方文档所说：</p>

<blockquote>
  <p>1.Create a Private Spec Repo</p>

  <p>To work with your collection of private pods, we suggest creating your own Spec repo. This should be in a location that is accessible to all who will use the repo.</p>

  <p>You do not need to fork the CocoaPods/Specs Master repo. Make sure that everyone on your team has access to this repo, but it does not need to be public.</p>
</blockquote>

<p>在 github 创建完私有库 <em>VJRepos</em> 后，执行下面命令:</p>

<p><code class="highlighter-rouge">$ pod repo add VJRepos https://github.com/Vergil-wj/VJRepos</code></p>

<p>成功的话就会在<code class="highlighter-rouge">~/.cocoapods/repos</code>目录下看到 <em>VJRepos</em> 文件夹了,如下图：</p>

<p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1g1pgwg1b23j30zk046t9k.jpg" alt="" /></p>

<h2 id="创建-pod-的所需要的项目工程文件并且有可访问的项目版本控制地址">创建 Pod 的所需要的项目工程文件，并且有可访问的项目版本控制地址</h2>

<p>如果是有现有的组件项目，并且在 Git 的版本管理下，那么这一步就算完成了，可以直接进行下一步了。</p>

<p>或者从 github 上新建一个空项目，勾选上 <strong>LICENSE</strong> 文件，并 clone 到本地，将项目中的公共组件拖进来。</p>

<h2 id="创建-pod-所对应的-podspec-文件">创建 Pod 所对应的 podspec 文件</h2>

<p>在项目根目录下，输入：</p>

<p><code class="highlighter-rouge">$ pod spec create VJDviceInfo</code></p>

<p>会看到项目中，多出一个 .podspec 文件</p>

<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1g1phth4b84j30me04saav.jpg" alt="" /></p>

<p>打开 .podspec 文件，并修改信息如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Pod::Spec.new do |s|
  s.name         = "VJDeviceInfo"
  s.version      = "1.0.0"
  s.ios.deployment_target = '8.0'
  s.summary      = "ios device info"
  s.homepage     = "https://github.com/Vergil-wj/VJDeviceInfo"
  s.license      = "MIT"
  s.author       = {  "houweijia" =&gt; "houweijiav@163.com"  }
  s.source       = { :git =&gt; "https://github.com/Vergil-wj/VJDeviceInfo.git", :tag =&gt; s.version }
  s.source_files  = "VJDeviceInfo"
  s.requires_arc = true
end
</code></pre></div></div>

<p>参数说明：</p>

<ul>
  <li>s.name：库名，和.podspec名字保持一致。</li>
  <li>s.versin：版本号。</li>
  <li>s.ios.deployment_target：支持最低版本。</li>
  <li>s.summary：简介</li>
  <li>s.homepage：项目主页地址</li>
  <li>s.license：许可证</li>
  <li>s.author：作者</li>
  <li>s.source：项目的地址</li>
  <li>s.source_files：需要包含的源文件</li>
  <li>s.requires_arc：是否支持ARC</li>
</ul>

<p>其它：</p>

<ul>
  <li>
    <p>s.social_media_url：社交网址，你的podspec发布成功后会@你</p>
  </li>
  <li>
    <p>s.dependency：依赖库，不能依赖未发布的库，例如：</p>

    <p><code class="highlighter-rouge">s.dependency 'AFNetworking'</code></p>
  </li>
</ul>

<p>未涉及到的请看<a href="https://guides.cocoapods.org/syntax/podspec.html">官方文档</a>。</p>

<h2 id="上传项目到-github并打上-tag">上传项目到 GitHub,并打上 tag</h2>

<p>1、上传到 GitHub</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add .
git commit -m '1.0.0 release'
git push
</code></pre></div></div>

<p>2、打上 tag</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag 1.0.0
git push origin 1.0.0
</code></pre></div></div>

<p>tag 的版本号要和 .podspec 中的版本号保持一致。</p>

<h2 id="本地测试配置好的-podspec-文件是否可用">本地测试配置好的 podspec 文件是否可用</h2>

<p>两种方式验证：</p>

<p>第一种：<code class="highlighter-rouge">$ pod lib lint</code></p>

<p>第二种：<code class="highlighter-rouge">$ pod spec lint VJDeviceInfo.podspec --verbose</code></p>

<ul>
  <li>verbose：输出详细信息</li>
</ul>

<p>我使用的第二种，输出结果如下：</p>

<p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1g1qg0x56wwj30ho03s0tj.jpg" alt="" /></p>

<p>验证成功！如果验证出错，请看文章末尾。</p>

<p>两种方式验证的不同之处：</p>

<blockquote>
  <p>The difference between them is that pod lib lint does not access the network, whereas pod spec lint checks the external repo and associated tag.</p>
</blockquote>

<p>pod lib lint 是只从本地验证你的 pod 能否通过验证.</p>

<p>pod spec lint 是从本地和远程验证你的 pod 能否通过验证.</p>

<h2 id="向私有的-spec-repo-中提交-podspec">向私有的 Spec Repo 中提交 podspec</h2>

<p>向我们的私有 Spec Repo 提交 podspec 只需要一个命令:</p>

<p><code class="highlighter-rouge">$ pod repo push VJRepos VJDeviceInfo.podspec</code></p>

<p>完成之后这个组件库就添加到我们的私有 Spec Repo 中了，可以进入到<code class="highlighter-rouge">~/.cocoapods/repos/VJRepos</code>目录下查看:</p>

<p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1g1qg6jm332j30ms03mjrw.jpg" alt="" /></p>

<p>再去看我们的 Spec Repo 远端仓库，也有了一次提交，这个 podspec 也已经被Push上去了。</p>

<h2 id="在个人项目中的-podfile-中增加刚刚制作的好的-pod-并使用">在个人项目中的 Podfile 中增加刚刚制作的好的 Pod 并使用</h2>

<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1g1qixbvy3qj30zq0bugpv.jpg" alt="" /></p>

<p>第一行是官方的 Spec repo，第二行是自己的 Spec reop；</p>

<p>然后打开项目可以看到，我们自己的库文件已经出现在 Pods 子项目中的 Pods 子目录下了。</p>

<p>到此，使用 CocoaPods 创建私有库已经完成，我们可以方便的管理自己的组件了。</p>

<h3 id="以上步骤中可能出现的错误">以上步骤中可能出现的错误</h3>

<p>1、</p>
<blockquote>
  <table>
    <tbody>
      <tr>
        <td>ERROR</td>
        <td>[iOS] unknown: Encountered an unknown error (Could not find a <code class="highlighter-rouge">ios</code> simulator (valid values: com.apple.coresimulator.simruntime.ios-12-2, com.apple.coresimulator.simruntime.tvos-12-2, com.apple.coresimulator.simruntime.watchos-5-2). Ensure that Xcode -&gt; Window -&gt; Devices has at least one <code class="highlighter-rouge">ios</code> simulator listed or otherwise add one.) during validation.</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<p>升级CocoaPods:</p>

<p><code class="highlighter-rouge">$ sudo gem install cocoapods </code></p>

<p>2、</p>

<blockquote>
  <p>warning: inexact rename detection was skipped due to too many files.
warning: you may want to set your diff.renameLimit variable to at least 29913 and retry the command.</p>
</blockquote>

<p>输入以下命令：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git config merge.renameLimit 999999
$ git config --unset merge.renameLimit

</code></pre></div></div>

<p>3、</p>

<blockquote>
  <p>[!] There was an error pushing a new version to trunk: execution expired</p>
</blockquote>

<p>执行：</p>

<p><code class="highlighter-rouge">$ pod trunk push VJUtils.podspec</code></p>

<p>若还是报这条错误，那就多试几次；</p>

<h6 id="参考资料">参考资料</h6>

<blockquote>
  <p><a href="https://guides.cocoapods.org/making/private-cocoapods.html">CocoaPods官网 https://guides.cocoapods.org/making/private-cocoapods.html</a></p>
</blockquote>

<blockquote>
  <p><a href="http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/">http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/</a></p>
</blockquote>

  </section>

</article>

<section>

  <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

  <ul class="pager">
    
    <li class="previous">
      <a href="/2019/04/04/git%E4%B8%ADtag%E6%93%8D%E4%BD%9C.html" data-toggle="tooltip" data-placement="top" title="git tag操作">上一篇：  <span>git tag操作</span>
      </a>
    </li>
    
    
    <li class="next">
      <a href="/2019/04/08/iOS-runtime-%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1.html" data-toggle="tooltip" data-placement="top" title="iOS runtime 类与对象">下一篇：  <span>iOS runtime 类与对象</span>
      </a>
    </li>
    
  </ul>
</section>


            <section class="footer">
  <footer>
    <div class = "footer_div">  
      <nav class="cover-navigation navigation--social">
        <ul class="navigation">

          
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/Vergil-wj" title="@Vergil-wj 的 Github" target="_blank">
              <div class="footer-social-icon" style="background:url(/images/github.png);"></div>
            </a>
          </li>
          

          
          <li class="navigation__item_social">
            <a href="https://www.jianshu.com/u/3e3ba42c4c63" title="@3e3ba42c4c63" target="_blank">
              <div class="footer-social-icon" style="background:url(/images/jianshu.jpg);"></div>
            </a>
          </li>

          

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:834372189@qq.com" title="Contact me">
              <div class="footer-social-icon" style="background:url(/images/email.png);"></div>
            </a>
          </li>
          
          
        </ul>
      </nav>

    </div>

    <div class = "footer_div">  

      <div align="center">
        <p class="copyright text-muted">
          Copyright &copy; Vergil 2019
        </p>
        <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
      </div>

    </div>
  </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>

</html>
