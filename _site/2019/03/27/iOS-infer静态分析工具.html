<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>iOS infer静态分析工具使用</title>
  <meta name="description" content="infer介绍">
  <meta name="author" content="leopardpan">

  <!-- <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="iOS infer静态分析工具使用">
  <meta name="twitter:description" content="infer介绍"> -->
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="iOS infer静态分析工具使用">
  <meta property="og:description" content="infer介绍">
  
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2019/03/27/iOS-infer%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7.html">
  <link rel="alternate" type="application/rss+xml" title="Vergil" href="http://localhost:4000/feed.xml">
  
  <!-- <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" /> -->



</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      标签
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
        <div class="panel-main__content">
            <!-- 头像效果-start -->
            <div class="ih-item circle effect right_to_left">            
                <a href="/#blog" title="前往 Vergil 的主页" class="blog-button">
                    <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                    <div class="info">
                        <div class="info-back">
                            <h2> 
                                
                                Vergil
                                
                            </h2>
                            <p>
                             
                             iOS
                             
                         </p>
                     </div>
                 </div>
             </a>
         </div>
         <!-- 头像效果-end -->
         <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Vergil" class="blog-button">Vergil</a></h1>

         
         <span class="panel-cover__subtitle panel-subtitle">iOS 开发者</span>
         

         <hr class="panel-cover__divider" />
         <p class="panel-cover__description">我用双手成就你的梦想！</p>
         <hr class="panel-cover__divider panel-cover__divider--secondary" />

         


         <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                <li class="navigation__item"><a href="/tags" title="tags">标签</a></li>
                
            </ul>
        </nav>
    </div>          
</div>


</div>
</div>
</div>


<div class="panel-cover--overlay cover-clear"></div>

</div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title">iOS infer静态分析工具使用</h1>
    <div class="post-meta"> 
      <time datetime="2019-03-27 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date">2019-03-27</time>  
    </div>
  </header>

  <section class="post">
    <h2 id="infer介绍">infer介绍</h2>

<p><a href="https://fbinfer.com/docs/getting-started.html">infer官网</a></p>

<p><a href="https://infer.liaohuqiu.net/">infer中文网站</a></p>

<p>Infer 是 Facebook 开源的、使用 OCaml 语言编写的静态分析工具，可以对C、Java 和 Objective-C 代码进行静态分析，可以检查出空指针访问、资源泄露以及内存泄露。</p>

<h2 id="infer安装">infer安装</h2>

<p>mac 终端下输入：</p>

<p><code class="highlighter-rouge">brew install infer</code></p>

<p>infer 就安装好了。</p>

<h2 id="infer使用">infer使用</h2>

<p>我们可以先在 test 目录下 ViewController.m 写一段 Objective-C 代码：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ViewController.h"

@interface ViewController ()
@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    NSString *str = @"1";
}

@end
</code></pre></div></div>
<p>首先用cd命令进入test目录，然后运行以下命令进行编译:</p>

<p><code class="highlighter-rouge">infer -- xcodebuild -target test -configuration Debug -sdk iphonesimulator</code></p>

<p>注意其中 test 是自己的项目名，编译结果:</p>

<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1g1h9vhh6b6j30bg04qgm0.jpg" alt="" /></p>

<p>在项目所在目录下多出build和infer-out文件夹.</p>

<p>build文件夹：捕获阶段: Infer 捕获编译命令(上面介绍的编译器命令)，将文件翻译成 Infer 内部的中间语言。运行环境和设备信息也有所体现。</p>

<p>infer-out文件夹：分析阶段产生的文件，Infer将分析bugs结果输出到不同格式文件中，如csv、txt、json 方便对分析结果进行加工分析。</p>

<p>运行后在终端会看到日志信息(同infer-out文件，可以以多种形式查看log信息):</p>

<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1g1ha1vrykxj30ra0awgp7.jpg" alt="" /></p>

<p>可以看出，我们的 ViewController.m 代码里有1个问题:</p>

<p><img src="https://ws3.sinaimg.cn/large/006tKfTcly1g1hae6uc86j30og022q3y.jpg" alt="" /></p>

<p>将代码修改如下:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSString *str = @"1";
NSLog(@"str = %@",str);
</code></pre></div></div>

<p>先手动删除build文件夹(注意事项第2点),再次执行上述命令:</p>

<p><code class="highlighter-rouge">infer -- xcodebuild -target test -configuration Debug -sdk iphonesimulator</code></p>

<p>结果:</p>

<p><img src="https://ws3.sinaimg.cn/large/006tKfTcly1g1hagvf3xmj30vq08w41g.jpg" alt="" /></p>

<p>问题已经消除，以上就是infer用法。</p>

<h2 id="注意事项">注意事项</h2>

<p>1、输入命令：</p>

<p><code class="highlighter-rouge">infer -- xcodebuild -target test -configuration Debug -sdk iphonesimulator</code></p>

<p>出现error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xcode-select: error: tool 'xcodebuild' requires Xcode, but active developer directory '/Library/Developer/CommandLineTools' is a command line tools instance
</code></pre></div></div>

<p>这种情况是这种情况是xcodebuild的路径不正确。将路径切换到Xcode的目录下,如下:</p>

<p><code class="highlighter-rouge">sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer/</code></p>

<p>2、在俩次执行编译命令的过程中，发现在没有对代码做任何更改的时候(bug还在)，报出BUILD SUCCEEDED的提示：</p>

<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1g1hbpckqe1j30la05mdhi.jpg" alt="" /></p>

<p>根据提示可以看到，此次build并没有分析任何文件。原因涉及到增量分析：</p>

<h4 id="增量模式和非增量模式">增量模式和非增量模式</h4>

<blockquote>
  <p>在第一次运行的时候，两种模式是一样的，都会对工程的所有文件进行编译检查，产生检查结果:</p>
</blockquote>

<blockquote>
  <p>增量模式：当已经产生分析结果后（build和infer-out文件夹），再执行编译命令，即为增量模式。如有代码没有改动，则此次不会有编译结果产生，如果代码有新的改动，此次只产生新的编译结果。这种以增量为基准的原则叫做增量模式。</p>
</blockquote>

<blockquote>
  <p>非增量模式：在删除了俩个文件夹的情况下，运行文件，会输出所有的编译信息，即此时处于非增量模式。</p>
</blockquote>

<h5 id="增量模式转化为非增量模式">增量模式转化为非增量模式</h5>

<p>第一种 直接删除文件夹(build和infer-out文件夹)</p>

<p>第二种 输入以下命令</p>

<p><code class="highlighter-rouge">xcodebuild -target HelloWorldApp -configuration Debug -sdk iphonesimulator clean</code></p>

<p>即在原来命令末尾加上 clean 。</p>


  </section>

</article>

<section>

  <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

  <ul class="pager">
    
    
    <li class="next">
      <a href="/2019/04/03/%E4%BD%BF%E7%94%A8CocoaPods%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%85%AC%E6%9C%89%E5%BA%93.html" data-toggle="tooltip" data-placement="top" title="使用CocoaPods构建自己的公有库">下一篇：  <span>使用CocoaPods构建自己的公有库</span>
      </a>
    </li>
    
  </ul>
</section>


            <section class="footer">
  <footer>
    <div class = "footer_div">  
      <nav class="cover-navigation navigation--social">
        <ul class="navigation">

          
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/Vergil-wj" title="@Vergil-wj 的 Github" target="_blank">
              <div class="footer-social-icon" style="background:url(/images/github.png);"></div>
            </a>
          </li>
          

          
          <li class="navigation__item_social">
            <a href="https://www.jianshu.com/u/3e3ba42c4c63" title="@3e3ba42c4c63" target="_blank">
              <div class="footer-social-icon" style="background:url(/images/jianshu.jpg);"></div>
            </a>
          </li>

          

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:834372189@qq.com" title="Contact me">
              <div class="footer-social-icon" style="background:url(/images/email.png);"></div>
            </a>
          </li>
          
          
        </ul>
      </nav>

    </div>

    <div class = "footer_div">  

      <div align="center">
        <p class="copyright text-muted">
          Copyright &copy; Vergil 2019
        </p>
        <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
      </div>

    </div>
  </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>

</html>
